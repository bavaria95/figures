<html>
<head>
<title>Game</title>
</head>
<body>

<style>
.circle {
	position: absolute;
	left: 300px;
	top: 300px;
    width: 100px;
    height: 100px;
    background: red;
    -moz-border-radius: 50px;
    -webkit-border-radius: 50px;
    border-radius: 50px;
}

.triangle {
    width: 0;
    height: 0;
    border-left: 50px solid transparent;
    border-right: 50px solid transparent;
    border-bottom: 100px solid red;
}

.trapezoid {
    border-bottom: 100px solid red;
    border-left: 50px solid transparent;
    border-right: 50px solid transparent;
    height: 0;
    width: 100px;
}

</style>

<button onclick="make()">Make move figures</button>
<button onclick="f()">Remove last figure</button>


<script>
var window_width = window.screen.availWidth;
var window_height = window.screen.availHeight;

var figures = [];

function Figure(type, id, level) {
	this.type = type;
	this.id = id;
	this.level = level;

	this.generate();
	this.move();
}

Figure.prototype.generate = function() {
	var pos_x = Math.floor((Math.random() * (window_width - this.bouncyRight - 10)));
	var pos_y = Math.floor((Math.random() * (window_height - this.bouncyBottom - 10)));

	var new_div = document.createElement("DIV"); 
	document.body.appendChild(new_div);  

    var fig = document.getElementsByTagName("div");
    var len = fig.length;
    fig = fig[len - 1];

	var att = document.createAttribute("class");
	att.value = this.type; 
	fig.setAttributeNode(att);
	
	var att = document.createAttribute("id");
	att.value = "figure" + len;
	fig.setAttributeNode(att);

	var att = document.createAttribute("style");
	att.value = "position: absolute; left: " + pos_x + "px;" + "top: " + pos_y + "px;";
	fig.setAttributeNode(att);
}


Figure.prototype.move = function() {

	var fig = document.getElementById('figure' + this.id);
	var bouncyBottom = this.bouncyBottom;
	var bouncyRight = this.bouncyRight;

	var speed_coef = 0.06 * this.level;

	var x = parseInt(fig.style.left);
	var y = parseInt(fig.style.top);

	var lastTime = null;

	var dx = Math.floor((Math.random() * 10) + 1) * Math.pow(-1, Math.round(Math.random()));
	var dy = Math.floor((Math.random() * 10) + 1) * Math.pow(-1, Math.round(Math.random()));


	function animate(time) {
		var rend_coef = 1;
		if (lastTime != null)
			rend_coef = (lastTime - time) * speed_coef;

		console.log(fig.bouncyBottom);
    	if ((x + dx < 0) || (x + dx > window_width - bouncyRight))
    		dx *= -1;
    	x += dx * rend_coef;

    	if ((y + dy < 0) || (y + dy > window_height - bouncyBottom))
    		dy *= -1;
    	y += dy * rend_coef;


    	fig.style.left = x + "px";
    	fig.style.top = y + "px";

    	requestAnimationFrame(animate);
  	}
  	requestAnimationFrame(animate);
}

Figure.prototype.remove = function() {
	var fig = document.getElementById('figure' + this.id);
	fig.parentNode.removeChild(fig);
	for (var i = 0; i < figures.length; i++)
		if (figures[i].id == this.id) {
			figures.splice(i, 1);
			break;
		}
}



function Trapezoid(id, level) {
	this.bouncyBottom = 210;
	this.bouncyRight = 200;
	Figure.call(this, 'trapezoid', id, level);


	var figure = document.getElementById('figure' + this.id);
	figure.addEventListener("mouseover", function() {
		var id = parseInt(/\d+/.exec(this.id));

		for (var i = 0; i < figures.length; i++)
			if (figures[i].id == id) {
				figures[i].remove();
				break;
			}
	});
}

Trapezoid.prototype = Object.create(Figure.prototype);


function Triangle(id, level) {
	this.bouncyRight = 95;
	this.bouncyBottom = 210;
	Figure.call(this, 'triangle', id, level);


	var figure = document.getElementById('figure' + this.id);
	figure.addEventListener("mouseover", function() {
		var id = parseInt(/\d+/.exec(this.id));
		console.log(figures);
		console.log(id);

		for (var i = 0; i < figures.length; i++)
		if (figures[i].id == id) {
			figures[i].remove();
			break;
		}
	});
}

Triangle.prototype = Object.create(Figure.prototype);


function Circle(id, level) {
	this.bouncyRight = 100;
	this.bouncyBottom = 207;
	Figure.call(this, 'circle', id, level);


	var figure = document.getElementById('figure' + this.id);
	figure.addEventListener("mouseover", function() {
		var id = parseInt(/\d+/.exec(this.id));
		console.log(figures);
		console.log(id);

		for (var i = 0; i < figures.length; i++)
		if (figures[i].id == id) {
			figures[i].remove();
			break;
		}
	});
}

Circle.prototype = Object.create(Figure.prototype);



function make() {
	var t = new Circle(1, 1);
	figures.push(t);

	console.log(t.style);

	t = new Triangle(2, 1);
	figures.push(t);

	t = new Trapezoid(3, 1);
	figures.push(t);

}

function f() {
	var last = figures[figures.length - 1];
	last.remove();
}

</script>

</body>
</html>
